<!DOCTYPE html>
<html lang="en">





<head>
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">

  <meta property="og:title" content="Stocks plugin for sopel" />
<meta property="og:description" content="Good ol&rsquo; irc is the best way to keep in contact with my friends, since &lsquo;98 or around." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://luisuribe.github.io/post/stocks-plugin-for-sopel/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-10-14T00:00:00+00:00" />
<meta property="article:modified_time" content="2021-10-15T17:21:36-05:00" /><meta property="og:site_name" content="Luis Uribe - blog" />

  <meta itemprop="name" content="Stocks plugin for sopel">
<meta itemprop="description" content="Good ol&rsquo; irc is the best way to keep in contact with my friends, since &lsquo;98 or around."><meta itemprop="datePublished" content="2021-10-14T00:00:00+00:00" />
<meta itemprop="dateModified" content="2021-10-15T17:21:36-05:00" />
<meta itemprop="wordCount" content="109">
<meta itemprop="keywords" content="" />
  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Stocks plugin for sopel"/>
<meta name="twitter:description" content="Good ol&rsquo; irc is the best way to keep in contact with my friends, since &lsquo;98 or around."/>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>
    
    Stocks plugin for sopel
    
  </title>
  <link rel="stylesheet" href='https://luisuribe.github.io/css/site.min.css'>
  <link rel="canonical" href="https://luisuribe.github.io/post/stocks-plugin-for-sopel/">
  <link rel="alternate" type="application/rss&#43;xml" href="https://luisuribe.github.io/index.xml" title="luisuribe">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="referrer" content="no-referrer">
  <meta name="author" content="Luis Uribe">
  <meta name="description" content="Good ol&rsquo; irc is the best way to keep in contact with my friends, since &lsquo;98 or around.">
</head>
<body><nav class="navbar is-transparent " role="navigation" aria-label="main navigation">
  <div class="navbar-brand">
    <a class="navbar-item" href="https://luisuribe.github.io/">
      <figure class="image">
        <img alt="" class="is-rounded" src="https://www.gravatar.com/avatar/cd3838fa3b53b8d704cf08209f4a62e1?s=128&d=identicon">
      </figure>
    </a>
    <a class="navbar-item" href="https://luisuribe.github.io/">
      luisuribe
    </a>
  </div>

  <div class="navbar-menu">
    <div class="navbar-start">
      
    </div>

    <div class="navbar-end">
      <a class="navbar-item" href="/" rel="noopener" target="_blank">
        blog
      </a>
      <a class="navbar-item" href="/labs" rel="noopener" target="_blank">
        labs
      </a>
      <a class="navbar-item" href="/about" rel="noopener" target="_blank">
        about
      </a>

      
      <a class="navbar-item" href="https://github.com/luisuribe/" rel="noopener" target="_blank">
        <span class="icon">
          
            <img alt="icons/svg/github.svg" src='https://luisuribe.github.io/icons/svg/github.svg'>
          
        </span>
      </a>
      
      <a class="navbar-item" href="https://gitlab.com/luisuribe/" rel="noopener" target="_blank">
        <span class="icon">
          
            <img alt="icons/svg/gitlab.svg" src='https://luisuribe.github.io/icons/svg/gitlab.svg'>
          
        </span>
      </a>
      
      <a class="navbar-item" href="https://www.linkedin.com/in/luribe/" rel="noopener" target="_blank">
        <span class="icon">
          
            <img alt="icons/svg/linkedin.svg" src='https://luisuribe.github.io/icons/svg/linkedin.svg'>
          
        </span>
      </a>
      
      <a class="navbar-item" href="https://luisuribe.github.io/index.xml" target="_blank">
        <span class="icon">
          <img alt="rss" src='https://luisuribe.github.io/icons/svg/rss.svg'>
        </span>
      </a>
      
    </div>
  </div>
</nav>

  <section>
    <section class='hero is-small is-info is-fullwidth'>
      <div class="hero-body">
<div class="container">
  <h1 class="title">
    Stocks plugin for sopel
  </h1>
  <h2 class="subtitle">
    <time datetime='2021-10-14T00:00:00Z'>
      October 14, 2021
    </time>
    
  </h2>
</div>

      </div>
    </section>
    <section class="section">
      <div class="container">
<div class="content is-medium">
  <p>Good ol&rsquo; irc is the best way to keep in contact with my friends, since &lsquo;98 or around. We use <a href="https://sopel.chat/">sopel</a> for some stuff, for example, to track all the stocks we own.</p>
<p>This is a simple <a href="https://github.com/dev-co/sopel-modules/blob/master/stocks.py">stocks plugin</a> for <a href="https://sopel.chat/">sopel</a>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> sopel
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> requests
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@sopel.module.commands</span>(<span style="color:#e6db74">&#39;dji&#39;</span>,<span style="color:#e6db74">&#39;stocks&#39;</span>,<span style="color:#e6db74">&#39;stock&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">stocks</span>(bot,trigger):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> trigger<span style="color:#f92672">.</span>group(<span style="color:#ae81ff">2</span>):
</span></span><span style="display:flex;"><span>        url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://rest.yahoofinanceapi.com/v6/finance/quote&#34;</span>
</span></span><span style="display:flex;"><span>        querystring <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#34;symbols&#34;</span>: trigger<span style="color:#f92672">.</span>group(<span style="color:#ae81ff">2</span>)}
</span></span><span style="display:flex;"><span>        headers <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#39;x-api-key&#39;</span>: <span style="color:#e6db74">&#34;FAKE_API_KEY&#34;</span>}
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>            response <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>request(<span style="color:#e6db74">&#34;GET&#34;</span>, url, headers<span style="color:#f92672">=</span>headers, params<span style="color:#f92672">=</span>querystring)
</span></span><span style="display:flex;"><span>            stock <span style="color:#f92672">=</span> response<span style="color:#f92672">.</span>json()[<span style="color:#e6db74">&#39;quoteResponse&#39;</span>][<span style="color:#e6db74">&#39;result&#39;</span>][<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">except</span> requests<span style="color:#f92672">.</span>exceptions<span style="color:#f92672">.</span>RequestException <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> bot<span style="color:#f92672">.</span>say(<span style="color:#e6db74">&#34;An error ocurred&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> bot<span style="color:#f92672">.</span>say(<span style="color:#e6db74">&#34;Please use a valid symbol&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    change <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{0:.2f}</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">.</span>format(float(stock[<span style="color:#e6db74">&#39;regularMarketChange&#39;</span>]))
</span></span><span style="display:flex;"><span>    percent <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{0:.2f}</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">.</span>format(float(stock[<span style="color:#e6db74">&#39;regularMarketChangePercent&#39;</span>]))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> bot<span style="color:#f92672">.</span>say(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{0}</span><span style="color:#e6db74">: </span><span style="color:#e6db74">{1}</span><span style="color:#e6db74"> (</span><span style="color:#e6db74">{2}</span><span style="color:#e6db74">/</span><span style="color:#e6db74">{3}</span><span style="color:#e6db74">)&#34;</span><span style="color:#f92672">.</span>format(stock[<span style="color:#e6db74">&#39;longName&#39;</span>], stock[<span style="color:#e6db74">&#39;regularMarketPrice&#39;</span>],<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x03</span><span style="color:#e6db74">04&#34;</span><span style="color:#f92672">+</span>change<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x0F</span><span style="color:#e6db74">&#34;</span> <span style="color:#66d9ef">if</span> float(change) <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span> <span style="color:#66d9ef">else</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x03</span><span style="color:#e6db74">03&#34;</span><span style="color:#f92672">+</span>change<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x0F</span><span style="color:#e6db74">&#34;</span>,<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x03</span><span style="color:#e6db74">04&#34;</span><span style="color:#f92672">+</span>percent<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;%</span><span style="color:#ae81ff">\x0F</span><span style="color:#e6db74">&#34;</span> <span style="color:#66d9ef">if</span> float(percent) <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span> <span style="color:#66d9ef">else</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x03</span><span style="color:#e6db74">03+&#34;</span><span style="color:#f92672">+</span>percent<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;%</span><span style="color:#ae81ff">\x0F</span><span style="color:#e6db74">&#34;</span>,str(stock[<span style="color:#e6db74">&#39;regularMarketOpen&#39;</span>])))
</span></span></code></pre></div>
</div>


      </div>
    </section>
  </section><footer class="footer">


  <div class="content has-text-centered">
    
    <p>
      Last modified October 15, 2021 | template based on <a href="https://github.com/orf/bare-hugo-theme" target="_blank">Bare Hugo theme.</a>
    </p>
    

  </div>
</footer>


</body>
</html>
